<!DOCTYPE html>
<html lang="en-us">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
 <title>Neuroevolution: bird simulation </title>



<meta name="description" content="A blog for my various projects">


<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<link rel="stylesheet" id="ct-tracks-google-fonts-css" href="//fonts.googleapis.com/css?family=Raleway%3A400%2C700&amp;subset=latin%2Clatin-ext&amp;ver=4.7.2" type="text/css" media="all">
<link rel="stylesheet" href="https://lordsk.github.io/css/font-awesome.min.css" type='text/css' media='all'>

<link href="https://lordsk.github.io/css/style.css" rel="stylesheet" id="theme-stylesheet" type='text/css' media='all'>

<link href="https://lordsk.github.io/css/custom.css" rel="stylesheet" type='text/css' media='all'>
<link rel="shortcut icon" href="https://lordsk.github.io/img/favicon.ico" type="image/x-icon">
<link rel="icon" href="https://lordsk.github.io/img/favicon.ico" type="image/x-icon">


</head>


<body class="post-template-default single single-post single-format-standard ct-body singular singular-post not-front standard">
  
  <div id="overflow-container" class="overflow-container">
    <a class="skip-content" href="#main">Skip to content</a>
    <header id="site-header" class="site-header" role="banner">
      <div class='top-navigation'>
        <div class='container'>

  <div id="menu-secondary" class="menu-container menu-secondary" role="navigation">
    <button id="toggle-secondary-navigation" class="toggle-secondary-navigation"><i class="fa fa-plus"></i></button>

    <div class="menu">

      <ul id="menu-secondary-items" class="menu-secondary-items">
        
        <li id="menu-item" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item">
          <a href="/categories/ai">AI</a>
        </li>
        
        <li id="menu-item" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item">
          <a href="/categories/resacred">Resacred</a>
        </li>
        

      </ul>

    </div>

  </div>


  <ul class="social-media-icons">


    

    

    
    <li>
      <a href="https://twitter.com/LordSk_" data-animate-hover="pulse" class="twitter" target="_blank">
        <i class="fa fa-twitter-square" title="twitter"></i>
        <span class="screen-reader-text">twitter</span>
      </a>
    </li>
    

    

    

    

    


    
    <li>
      <a href="https://github.com/LordSk" data-animate-hover="pulse" class="github" target="_blank">
        <i class="fa fa-github" title="github"></i>
        <span class="screen-reader-text">github</span>
      </a>
    </li>
    

  </ul></div>

      </div>

      <div class="container">
        <div id="title-info" class="title-info">
  <div id='site-title' class='site-title'>
    
    <a href="/"> LordSk&#39;s blog </a>
    </div>
  </div>
  <button id="toggle-navigation" class="toggle-navigation">
    <i class="fa fa-bars"></i>
  </button>

  <div id="menu-primary-tracks" class="menu-primary-tracks"></div>
  <div id="menu-primary" class="menu-container menu-primary" role="navigation">
    

    <div class="menu">
      <ul id="menu-primary-items" class="menu-primary-items">
        <li id="menu-item" class="menu-item menu-item-type-custom menu-item-object-custom current-menu-item current_page_item menu-item-home menu-item">
          <a href="/">Home</a>
        </li>

        
        
        
        
        <li id="menu-item" class="menu-item menu-item-type-post_type menu-item-object-page menu-item">
          <a href="/cv/">CV</a>
        </li>
        
        
        
        <li id="menu-item" class="menu-item menu-item-type-post_type menu-item-object-page menu-item">
          <a href="/contact/">Contact</a>
        </li>
        
        
      </ul>



    </div>

  </div>

      </div>
    </header>

    <div id="main" class="main" role="main">

      
  <div id="loop-container" class="loop-container">
    
    <div class="post type-post status-publish format-standard has-post-thumbnail hentry category-design tag-design tag-standard-2 tag-tagalicious tag-travel entry full-without-featured odd excerpt-1">

      <div class='featured-image lazy lazy-bg-image' data-background="https://lordsk.github.io/img/burds_1.jpg">
      </div>
      
        <div class="entry-meta">
          <span class="date">April 17</span>	<span> / </span>

          <span class="author">
            
            <a href="https://lordsk.github.io/" title="Posts by LordSk" rel="author">LordSk</a>
            
          </span>


          
          <span class="category">
            <span> / </span>

            <a href="/categories/AI">AI</a>
          </span>
          


        </div>
        <div class='entry-header'>
          <h1 class='entry-title'> Neuroevolution: bird simulation</h1>
        </div>
        <div class="entry-container">
          <div class="entry-content">
            <article>
              

<p>We now know how to train feed forward neural networks through evolution. Let&rsquo;s see how it fairs in a &ldquo;real&rdquo; environment.</p>

<h3 id="burds">Burds</h3>

<p>I created a little simulation where 2D birds try to manoeuvre in the air in order to eat apples. They can flap their wings (moving them forward), turn left, right and &ldquo;brake&rdquo; to some extent
(this makes much more sense in motion, see video below). They have 10 seconds to reach the next apple. Upon reaching it, their lifetime is reset to 10 seconds. If they touch the ground they die.</p>

<h3 id="brain">Brain</h3>

<p>Here is the very simple NN topology I used.</p>

<p><img src="/img/burd_nn.png" alt="burd NN" title="burd NN" /></p>

<p>A <strong>6x4x4</strong> fully connected feed forward NN.</p>

<h4 id="input">Input</h4>

<ul>
<li><strong>offsetX</strong>/<strong>offsetY</strong> is the relative distance between the next apple and the bird.</li>
<li><strong>velocityX</strong>/<strong>velocityY</strong> is the velocity vector of the bird.</li>
<li><strong>angle</strong> is the orientation of the bird.</li>
<li><strong>canFlap</strong> is either 1 or 0 depending of the flap cooldown.</li>
</ul>

<h4 id="output">Output</h4>

<ul>
<li><strong>turnLeft</strong>/<strong>turnRight</strong> will rotate the bird left or right.</li>
<li><strong>flap</strong> will make the bird flap if it can.</li>
<li><strong>brake</strong> will make the bird slow down.</li>
</ul>

<h3 id="fitness-function">Fitness function</h3>

<p>Now what is the fitness function? The objective here is to <strong>eat apples</strong>, so</p>

<p><code>fitness = appleEatenCount</code></p>

<p>makes sense. One bird flying in a random direction will eventually hit and apple leading to more
and more birds reaching the first apple. The cycle repeats for the next apple and so on. This would, after a very long time, converge to the solution we want, eating all the apples.
But we can do better than that, much better in fact. We can start by taking <strong>the distance to the next apple</strong> in account. At any point t the fitness function then becomes</p>

<p><code>fitness = appleEatenCount + 1/distanceToNextApple</code></p>

<p>The closer a bird is to the next apple, the more fit it is. However birds naturally will move in a curved manner, getting farther to the next apple before getting closer.
This function only rewards getting closer which is not ultimately what we want. In the end here is the code I settled on.</p>

<pre><code>distFactor = 1.0 - (min(distance(birdPos, applePos), 2000) / 2000.0) // 0.0 -&gt; 1.0
healthFactor = birdHealth / HEALTH_MAX

// fitness accumulation every frame
fitnessAcc += (healthFactor + distFactor * distFactor) * FRAME_DT
fitness = fitnessAcc
fitness += fitness * 0.1 * appleEatenCount
</code></pre>

<p>I won&rsquo;t go too much into details, but this function rewards staying close to the next apple, being healthy (and therefore quick) and of course eating apples.
So finally, here is the result.</p>


<div style="position: relative; padding-bottom: 56.25%; padding-top: 30px; height: 0; overflow: hidden;">
  <iframe src="//www.youtube.com/embed/DlfPMHCaD90" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" allowfullscreen frameborder="0" title="YouTube Video"></iframe>
 </div>


            </article>
          </div>
          
      <div class='entry-meta-bottom'>
        

  <div class="entry-categories"><p><span>Categories</span>
    
    <a href="/categories/ai" title="View all posts in AI">AI</a>
    <a href="/categories/resacred" title="View all posts in Resacred">Resacred</a>
  </p>
</div>



<div class="entry-tags"><p><span>Tags</span>
  

</p></div>	</div>

<div class="author-meta">

  <div class="author">
    <img alt='LordSk' src="https://www.gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e?s=100&d=identicon" class='avatar avatar-72 photo' height='72' width='72'>

    <span>
      Written by:<a href="https://lordsk.github.io/" title="Posts by LordSk" rel="author">LordSk</a>        </span>
    </div>
    <div class="bio">
      
      <p></p>
      


      

    


  
  <a class="twitter" target="_blank"
  href="https://twitter.com/LordSk_">
  <i class="fa fa-twitter-square"
  title="twitter icon"></i>
</a>










<a class="github" target="_blank"
href="https://github.com/LordSk">
<i class="fa fa-github"
title="github icon"></i>
</a>


</div>
</div>

</div>
</div>

<section id="comments" class="comments">
  <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "lordskblog" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

  




</section>
</div>

 



    </div>

    <footer id="site-footer" class="site-footer" role="contentinfo">
	<h1>
    
    <a href=""> LordSk&#39;s blog </a>
    
	</h1>

			

		<div id="menu-footer" class="menu-container menu-footer" role="navigation">
		<div class="menu">

      <ul id="menu-footer-items" class="menu-footer-items">
        
        <li id="menu-item" class="menu-item menu-item-type-post_type menu-item-object-page menu-item"><a href="/">Home</a></li>
        
        <li id="menu-item" class="menu-item menu-item-type-post_type menu-item-object-page menu-item"><a href="/cv/">CV</a></li>
        
        <li id="menu-item" class="menu-item menu-item-type-post_type menu-item-object-page menu-item"><a href="/contact/">Contact</a></li>
        
</ul>

</div>	</div>

<ul class="social-media-icons">

        

        


        
        <li>
        <a href="https://twitter.com/LordSk_"  class="twitter" target="_blank">
            <i class="fa fa-twitter-square" title="twitter"></i>
            <span class="screen-reader-text">twitter</span>
        </a>
        </li>
        

        

        

        

        


        
        <li>
        <a href="https://github.com/LordSk"  class="github" target="_blank">
            <i class="fa fa-github" title="github"></i>
            <span class="screen-reader-text">github</span>
        </a>
        </li>
        
				</ul>	<div class="design-credit">
		
		<p>&copy; 2018 Thomas &lsquo;LordSk&rsquo; Leroy</p>
		
		<p>Nederburg Hugo Theme by <a href="https://appernetic.io">Appernetic</a>.</p>
		
	</div>
</footer>

  </div>
  <script src="https://lordsk.github.io/js/jquery.min.js"></script>
<script src="https://lordsk.github.io/js/jquerymigrate.js"></script>
<script src="https://lordsk.github.io/js/production.min.js"></script>

</body>
</html>
